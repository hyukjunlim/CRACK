2025-04-03 01:13:54 - INFO - [<module>] - --- Starting Training Script ---
2025-04-03 01:13:54 - INFO - [<module>] - Output directory: flow_output/exp1
2025-04-03 01:13:54 - INFO - [<module>] - Log file: flow_output/exp1/training.log
2025-04-03 01:13:54 - INFO - [<module>] - Torch device: cuda
2025-04-03 01:13:54 - INFO - [<module>] - Loading trajectory data...
2025-04-03 01:13:54 - INFO - [load_trajectory_data] - Searching for trajectory files in mpflow_data matching pattern 'embeddings_*.npz'. Found 106 files.
2025-04-03 01:13:54 - INFO - [load_trajectory_data] - Scanning files to determine total size and shape...
2025-04-03 01:14:03 - INFO - [load_trajectory_data] - Determined sample shape: (2, 49, 128), dtype: float32 from mpflow_data/embeddings_0000.npz
2025-04-03 01:22:48 - INFO - [load_trajectory_data] - Scanned 50/106 files. Current valid samples: 346914
2025-04-03 01:31:56 - INFO - [load_trajectory_data] - Scanned 100/106 files. Current valid samples: 691735
2025-04-03 01:33:04 - INFO - [load_trajectory_data] - Scan complete. Total valid samples: 733680, Sample shape: (2, 49, 128), Dtype: float32
2025-04-03 01:33:04 - INFO - [load_trajectory_data] - Allocating array with shape: (733680, 2, 49, 128)
2025-04-03 01:33:04 - INFO - [load_trajectory_data] - Array allocation successful.
2025-04-03 01:33:04 - INFO - [load_trajectory_data] - Loading data from 106 valid files into pre-allocated array...
2025-04-03 01:36:56 - INFO - [load_trajectory_data] - Shuffling 733680 trajectories...
2025-04-03 01:37:15 - INFO - [load_trajectory_data] - Data loading and shuffling complete.
2025-04-03 01:37:15 - INFO - [<module>] - Loaded trajectories shape: (733680, 2, 49, 128)
2025-04-03 01:37:15 - INFO - [<module>] - Starting model training...
2025-04-03 01:37:15 - INFO - [train_flow_model] - Preparing data...
2025-04-03 01:37:15 - INFO - [train_flow_model] - Training samples: 586944, Validation samples: 146736
2025-04-03 01:37:15 - INFO - [train_flow_model] - Initializing FlowMatching model...
2025-04-03 01:37:19 - INFO - [train_flow_model] - Model parameters: 2825088
2025-04-03 01:37:19 - INFO - [train_flow_model] - Starting training for 1550 epochs with batch size 128.
2025-04-03 01:41:17 - INFO - [train_flow_model] - --- Generating Visualization for Epoch 1 ---
2025-04-03 01:41:22 - INFO - [train_flow_model] - --- Visualization for Epoch 1 saved ---
2025-04-03 02:19:13 - INFO - [train_flow_model] - Epoch 10/1550, Average Training Loss: 0.751446
2025-04-03 02:19:13 - INFO - [train_flow_model] - --- Starting Validation for Epoch 10 ---
2025-04-03 02:19:13 - INFO - [validate_model] - Starting validation...
2025-04-03 02:19:13 - INFO - [validate_model] - Processing 146736 validation samples in 1147 batches.
2025-04-03 02:19:23 - INFO - [validate_model] - Validation finished. Average loss: 0.678212
2025-04-03 02:19:23 - INFO - [train_flow_model] - Epoch 10/1550, Validation Loss: 0.678212
2025-04-03 02:19:23 - INFO - [train_flow_model] - New best validation loss: 0.678212 (previous: inf). Saving model.
2025-04-03 02:19:23 - INFO - [save_model] - Saving model checkpoint to flow_output/exp1/best_flow_model.pt
2025-04-03 03:01:34 - INFO - [train_flow_model] - Epoch 20/1550, Average Training Loss: 0.431737
2025-04-03 03:01:34 - INFO - [train_flow_model] - --- Starting Validation for Epoch 20 ---
2025-04-03 03:01:34 - INFO - [validate_model] - Starting validation...
2025-04-03 03:01:34 - INFO - [validate_model] - Processing 146736 validation samples in 1147 batches.
2025-04-03 03:01:44 - INFO - [validate_model] - Validation finished. Average loss: 0.418206
2025-04-03 03:01:44 - INFO - [train_flow_model] - Epoch 20/1550, Validation Loss: 0.418206
2025-04-03 03:01:44 - INFO - [train_flow_model] - New best validation loss: 0.418206 (previous: 0.678212). Saving model.
2025-04-03 03:01:44 - INFO - [save_model] - Saving model checkpoint to flow_output/exp1/best_flow_model.pt
2025-04-03 03:43:51 - INFO - [train_flow_model] - Epoch 30/1550, Average Training Loss: 0.331699
2025-04-03 03:43:51 - INFO - [train_flow_model] - --- Starting Validation for Epoch 30 ---
2025-04-03 03:43:51 - INFO - [validate_model] - Starting validation...
2025-04-03 03:43:51 - INFO - [validate_model] - Processing 146736 validation samples in 1147 batches.
2025-04-03 03:44:01 - INFO - [validate_model] - Validation finished. Average loss: 0.327148
2025-04-03 03:44:01 - INFO - [train_flow_model] - Epoch 30/1550, Validation Loss: 0.327148
2025-04-03 03:44:01 - INFO - [train_flow_model] - New best validation loss: 0.327148 (previous: 0.418206). Saving model.
2025-04-03 03:44:01 - INFO - [save_model] - Saving model checkpoint to flow_output/exp1/best_flow_model.pt
2025-04-03 04:26:15 - INFO - [train_flow_model] - Epoch 40/1550, Average Training Loss: 0.281055
2025-04-03 04:26:15 - INFO - [train_flow_model] - --- Starting Validation for Epoch 40 ---
2025-04-03 04:26:15 - INFO - [validate_model] - Starting validation...
2025-04-03 04:26:15 - INFO - [validate_model] - Processing 146736 validation samples in 1147 batches.
2025-04-03 04:26:25 - INFO - [validate_model] - Validation finished. Average loss: 0.278666
2025-04-03 04:26:25 - INFO - [train_flow_model] - Epoch 40/1550, Validation Loss: 0.278666
2025-04-03 04:26:25 - INFO - [train_flow_model] - New best validation loss: 0.278666 (previous: 0.327148). Saving model.
2025-04-03 04:26:25 - INFO - [save_model] - Saving model checkpoint to flow_output/exp1/best_flow_model.pt
2025-04-03 05:08:43 - INFO - [train_flow_model] - Epoch 50/1550, Average Training Loss: 0.262279
2025-04-03 05:08:43 - INFO - [train_flow_model] - --- Starting Validation for Epoch 50 ---
2025-04-03 05:08:43 - INFO - [validate_model] - Starting validation...
2025-04-03 05:08:44 - INFO - [validate_model] - Processing 146736 validation samples in 1147 batches.
2025-04-03 05:08:53 - INFO - [validate_model] - Validation finished. Average loss: 0.258570
2025-04-03 05:08:53 - INFO - [train_flow_model] - Epoch 50/1550, Validation Loss: 0.258570
2025-04-03 05:08:53 - INFO - [train_flow_model] - New best validation loss: 0.258570 (previous: 0.278666). Saving model.
2025-04-03 05:08:53 - INFO - [save_model] - Saving model checkpoint to flow_output/exp1/best_flow_model.pt
2025-04-03 05:51:18 - INFO - [train_flow_model] - Epoch 60/1550, Average Training Loss: 0.316216
2025-04-03 05:51:18 - INFO - [train_flow_model] - --- Starting Validation for Epoch 60 ---
2025-04-03 05:51:18 - INFO - [validate_model] - Starting validation...
2025-04-03 05:51:18 - INFO - [validate_model] - Processing 146736 validation samples in 1147 batches.
2025-04-03 05:51:29 - INFO - [validate_model] - Validation finished. Average loss: 0.317128
2025-04-03 05:51:29 - INFO - [train_flow_model] - Epoch 60/1550, Validation Loss: 0.317128
2025-04-03 05:51:29 - INFO - [train_flow_model] - Validation loss did not improve. Patience counter: 1/100
2025-04-03 06:33:36 - INFO - [train_flow_model] - Epoch 70/1550, Average Training Loss: 0.265766
2025-04-03 06:33:36 - INFO - [train_flow_model] - --- Starting Validation for Epoch 70 ---
2025-04-03 06:33:36 - INFO - [validate_model] - Starting validation...
2025-04-03 06:33:36 - INFO - [validate_model] - Processing 146736 validation samples in 1147 batches.
2025-04-03 06:33:46 - INFO - [validate_model] - Validation finished. Average loss: 0.284073
2025-04-03 06:33:46 - INFO - [train_flow_model] - Epoch 70/1550, Validation Loss: 0.284073
2025-04-03 06:33:46 - INFO - [train_flow_model] - Validation loss did not improve. Patience counter: 2/100
2025-04-03 07:15:49 - INFO - [train_flow_model] - Epoch 80/1550, Average Training Loss: 0.234499
2025-04-03 07:15:49 - INFO - [train_flow_model] - --- Starting Validation for Epoch 80 ---
2025-04-03 07:15:49 - INFO - [validate_model] - Starting validation...
2025-04-03 07:15:49 - INFO - [validate_model] - Processing 146736 validation samples in 1147 batches.
2025-04-03 07:15:59 - INFO - [validate_model] - Validation finished. Average loss: 0.277217
2025-04-03 07:15:59 - INFO - [train_flow_model] - Epoch 80/1550, Validation Loss: 0.277217
2025-04-03 07:15:59 - INFO - [train_flow_model] - Validation loss did not improve. Patience counter: 3/100
2025-04-03 07:58:02 - INFO - [train_flow_model] - Epoch 90/1550, Average Training Loss: 0.211841
2025-04-03 07:58:02 - INFO - [train_flow_model] - --- Starting Validation for Epoch 90 ---
2025-04-03 07:58:02 - INFO - [validate_model] - Starting validation...
2025-04-03 07:58:02 - INFO - [validate_model] - Processing 146736 validation samples in 1147 batches.
2025-04-03 07:58:12 - INFO - [validate_model] - Validation finished. Average loss: 0.200757
2025-04-03 07:58:12 - INFO - [train_flow_model] - Epoch 90/1550, Validation Loss: 0.200757
2025-04-03 07:58:12 - INFO - [train_flow_model] - New best validation loss: 0.200757 (previous: 0.258570). Saving model.
2025-04-03 07:58:12 - INFO - [save_model] - Saving model checkpoint to flow_output/exp1/best_flow_model.pt
2025-04-03 08:40:17 - INFO - [train_flow_model] - Epoch 100/1550, Average Training Loss: 0.189652
2025-04-03 08:40:17 - INFO - [train_flow_model] - --- Starting Validation for Epoch 100 ---
2025-04-03 08:40:17 - INFO - [validate_model] - Starting validation...
2025-04-03 08:40:17 - INFO - [validate_model] - Processing 146736 validation samples in 1147 batches.
2025-04-03 08:40:27 - INFO - [validate_model] - Validation finished. Average loss: 0.185494
2025-04-03 08:40:27 - INFO - [train_flow_model] - Epoch 100/1550, Validation Loss: 0.185494
2025-04-03 08:40:27 - INFO - [train_flow_model] - New best validation loss: 0.185494 (previous: 0.200757). Saving model.
2025-04-03 08:40:27 - INFO - [save_model] - Saving model checkpoint to flow_output/exp1/best_flow_model.pt
2025-04-03 08:40:28 - INFO - [train_flow_model] - --- Generating Visualization for Epoch 100 ---
2025-04-03 08:40:30 - INFO - [train_flow_model] - --- Visualization for Epoch 100 saved ---
